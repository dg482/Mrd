on:
  - pull_request
  - push

name: static analysis

jobs:
  mutation:
    name: PHP ${{ matrix.php }}-${{ matrix.os }}

    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os:
          - ubuntu-latest

        php:
          - "7.4"

    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4

      - name: Install PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: "${{ matrix.php }}"
          tools: composer:v2, cs2pr
          coverage: none

      - name: Determine composer cache directory
        run: echo "COMPOSER_CACHE_DIR=$(composer config cache-dir)" >> $GITHUB_ENV

      - name: Cache dependencies installed with composer
        uses: actions/cache@v2
        with:
          path: ${{ env.COMPOSER_CACHE_DIR }}
          key: php${{ matrix.php }}-composer-${{ hashFiles('**/composer.json') }}
          restore-keys: |
            php${{ matrix.php }}-composer-
      - name: Update composer
        run: composer self-update

      - name: Install dependencies with composer
        run: composer update --prefer-dist --no-interaction --no-progress --optimize-autoloader --ansi
      - name: Psalm – Static Analysis for PHP
          # You may pin to the exact commit or the version.
          # uses: psalm/psalm-github-actions@2e545d38ff4387b370449e2673088cc8dc40cf1d
          uses: psalm/psalm-github-actions@1.1.2
          with:
            # Whether or not to use Psalm’s security analysis
            security_analysis: # optional
            # File for Psalm’s output
            report_file: # optional, default is
            # Whether or not Composer installs dev packages
            composer_require_dev: # optional
            # Whether or not the --ignore-platform-reqs flag is passed to Composer
            composer_ignore_platform_reqs: # optional
